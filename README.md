# 名刺管理システム（画像スキャン対応）

## プロジェクト概要
- **名前**: Business Card Management System with Image Scanning (名刺管理システム)
- **目標**: 社内での取引先情報を効率的に管理・共有するWebアプリケーション
- **主要機能**: 
  - 名刺情報のCRUD操作（作成・読取・更新・削除）
  - **📸 名刺画像のスキャンとアップロード機能**
  - **📱 モバイルカメラによるリアルタイム撮影**
  - **🔍 OCR（光学文字認識）による自動テキスト抽出**
  - **🤖 AI自動解析による名刺フィールドへの自動入力**
  - 高度な検索・フィルタ機能
  - カテゴリによる分類管理
  - レスポンシブデザイン（PC・モバイル対応）

## 現在のアクセスURL
- **開発環境**: https://3000-iz9y7nlazelbr1s43qy3t-6532622b.e2b.dev
- **ヘルスチェック**: https://3000-iz9y7nlazelbr1s43qy3t-6532622b.e2b.dev/api/health
- **API エンドポイント**: 
  - 名刺一覧: `GET /api/business-cards`
  - 名刺詳細: `GET /api/business-cards/:id`
  - 名刺作成: `POST /api/business-cards`
  - 名刺更新: `PUT /api/business-cards/:id`
  - 名刺削除: `DELETE /api/business-cards/:id`
  - カテゴリ一覧: `GET /api/categories`
  - **🆕 画像アップロード**: `POST /api/images/upload`
  - **🆕 画像取得**: `GET /api/images/:filename`
  - **🆕 画像削除**: `DELETE /api/images/:filename`

## データアーキテクチャ
- **データベース**: Cloudflare D1 (SQLite互換)
- **画像ストレージ**: Cloudflare R2 (S3互換)
- **主要テーブル**:
  - `business_cards`: 名刺情報（会社名、担当者名、連絡先、**画像URL**等）
  - `company_categories`: 企業カテゴリ（取引先、顧客、パートナー等）
  - `business_card_categories`: 名刺とカテゴリの関連テーブル
- **データフロー**: 
  - フロントエンド → Hono API → D1データベース（メタデータ）
  - 画像ファイル → Cloudflare R2ストレージ（バイナリデータ）
  - 自動画像最適化・リサイズ処理

## ✨ 新機能：名刺画像スキャン & OCR自動入力

### 📸 画像アップロード機能
✅ **ファイル選択アップロード**
- JPEG、PNG、WebP対応（最大5MB）
- 自動リサイズ（最大1200x800px）
- 高品質JPEG圧縮（品質80%）

✅ **モバイルカメラ撮影**
- リアルタイムカメラプレビュー
- 背面カメラ優先設定
- ワンタッチ撮影機能

✅ **画像最適化・処理**
- 自動リサイズでファイルサイズ削減
- 名刺スキャン用コントラスト・明度調整
- プログレスバー表示付きアップロード

✅ **画像管理**
- 名刺一覧での画像サムネイル表示
- 編集画面での画像プレビュー
- ワンクリック画像削除機能

### 🔍 **OCR（光学文字認識）機能**
✅ **高精度テキスト認識**
- Tesseract.js搭載による日英両言語対応
- 名刺専用画像前処理でOCR精度向上
- リアルタイム進捗表示

✅ **AI自動解析・フィールド入力**
- 会社名、担当者名、部署、役職の自動抽出
- メールアドレス、電話番号、住所の自動認識
- 既存入力値を保護する安全な自動入力

✅ **OCR結果の確認・編集**
- 抽出されたテキストの確認表示
- 認識精度の表示とアラート
- 手動での結果修正・再解析機能

### 📱 モバイル最適化
- タッチフレンドリーなUI
- カメラアクセス権限自動要求
- 高解像度撮影対応（1280x720）
- 背面カメラ自動選択

## 完成済み機能

✅ **基本CRUD機能**
- 名刺の新規登録・編集・削除
- 詳細情報の表示
- **🆕 名刺画像の関連付け**

✅ **検索・フィルタ機能**
- キーワード検索（会社名、担当者名、メールアドレス）
- 会社名での絞り込み
- カテゴリでの絞り込み
- 検索結果のページネーション

✅ **カテゴリ管理**
- 5つのデフォルトカテゴリ（取引先、顧客、パートナー、競合他社、その他）
- カテゴリ別色分け表示

✅ **画像スキャン・管理**
- ファイルアップロード機能
- モバイルカメラ撮影
- 自動画像最適化
- 画像表示・削除機能

✅ **ユーザーインターフェース**
- モダンでレスポンシブなデザイン
- モーダルベースの編集画面
- リアルタイム検索
- アニメーション効果
- **🆕 画像プレビュー機能**

## 技術的特徴

### 🔧 画像処理技術
- **Canvas API**: クライアントサイド画像処理
- **自動リサイズ**: アスペクト比保持リサイズ
- **画像最適化**: 高品質JPEG圧縮
- **名刺スキャン強化**: コントラスト・明度自動調整

### 🤖 OCR・AI解析技術
- **Tesseract.js**: WebAssembly版OCRエンジン
- **多言語対応**: 日本語（ひらがな・カタカナ・漢字）・英語認識
- **正規表現パターンマッチング**: メール・電話・住所の高精度抽出
- **名刺情報構造化**: 企業・個人情報の自動分類

### 📱 モバイル対応
- **Camera API**: `getUserMedia`でリアルタイムカメラアクセス
- **ファイル形式対応**: JPEG/PNG/WebP
- **プログレッシブアップロード**: 進捗表示付きアップロード

### ☁️ Cloudflare統合
- **D1データベース**: 名刺メタデータ管理
- **R2ストレージ**: 高速画像配信（CDN付き）
- **Workers**: エッジでの高速API処理

## ユーザーガイド

### 📸 名刺画像の追加とOCR活用方法
1. **画像のアップロード**:
   - 「ファイル選択」で既存画像をアップロード
   - 「カメラで撮影」でリアルタイム撮影
   
2. **OCRによる自動入力**:
   - 画像アップロード後「テキストを読み取る」をクリック
   - 自動で日本語・英語を認識して抽出
   - 「自動解析・入力」で各フィールドに自動入力

3. **撮影のコツ（OCR精度向上のため）**:
   - 名刺を画面中央に配置し、水平に保持
   - 十分な明るさを確保（影を避ける）
   - 名刺全体が画面に収まるよう調整
   - 手ブレを防ぎ、鮮明な画像を撮影

4. **OCR結果の活用**:
   - 認識されたテキストを確認・修正
   - 自動入力された情報をチェック
   - 必要に応じて手動で補正

### 🔍 名刺の検索・活用
1. **画像付き名刺一覧**:
   - 名刺画像がサムネイル表示
   - 視覚的に名刺を素早く特定

2. **詳細情報と画像**:
   - 名刺をクリックで詳細表示
   - 大きな画像で内容確認

## デプロイメント情報
- **プラットフォーム**: Cloudflare Pages + R2
- **ステータス**: ✅ 開発環境で稼働中
- **技術スタック**: 
  - バックエンド: Hono + TypeScript + Cloudflare Workers
  - フロントエンド: Vanilla JavaScript + Tailwind CSS + Canvas API
  - データベース: Cloudflare D1 (SQLite)
  - 画像ストレージ: Cloudflare R2
  - 開発ツール: Vite + PM2
- **最終更新日**: 2025-09-08

## 開発次のステップ
1. **プロダクション環境デプロイ**: R2バケット設定とCloudflare Pages本格デプロイ
2. **AI画像認識統合**: OCRによる名刺情報自動入力
3. **QRコード読み取り**: vCard形式の自動インポート
4. **バッチ画像処理**: 複数枚同時アップロード
5. **画像品質向上**: AI画像補正機能

## 注意事項
- **開発環境制限**: 現在R2ストレージは本番環境でのみ利用可能
- **カメラ権限**: HTTPS環境でのみカメラアクセス可能
- **ファイル制限**: 画像ファイルは最大5MBまで
- **対応ブラウザ**: Chrome、Safari、Edge（カメラ機能）

このシステムにより、従来の名刺情報管理に加えて、実際の名刺画像を効率的にスキャン・保存・管理することが可能になりました！📸✨